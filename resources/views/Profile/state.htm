<section >
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2 class="section-heading">{t k='accountdashboard' g='in'}</h2>
                </div>
            </div>
        </div>    
</section>            
       
<section >
        <div class="container">  
        <div class="col-lg-6">
            <div class="panel panel-default companyinlist">
            <div class="panel-heading">
            {t k='userlogininformation' g='in'}
            </div>
                        
        <div class="panel-body">
            <table class="table table-striped">
            <tr>
                <td>Email</td>
                <td><strong>{$USER.email}</strong></td>
                <td><button type="button" class="btn btn-info btn-xs" data-toggle="modal" data-target="#emailchange">{t key="change" }</button></td>
            </tr>
            <tr>
                <td>{t key="yourname" group="account"}</td>
                <td><strong>{$USER.name}</strong></td>
                <td><button type="button" class="btn btn-info btn-xs" data-toggle="modal" data-target="#namechange">{t key="change" }</button></td>
            </tr>
            {if $USER.logintype == 'site'}
            <tr>
                <td>{t key="password" }</td>
                <td>*************</td>
                <td><button type="button" class="btn btn-info btn-xs" data-toggle="modal" data-target="#passwordchange">{t key="changepassword" group="account"}</button></td>
            </tr>
            {/if}
            </table>
                </div>
                </div>
        </div>
        
        </div>
</section>
       
       
<div id="emailchange" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">{t key="changeemail" group="account"}</h4>
        </div>
        <div class="modal-body" id="emailchangebody">
            <div id="emailchangebodyform">
            <form role="form" method="POST" action="{link do="changeaccemail" controller="profile"}" >
            <div class="row">
                <div class="col-md-6 col-md-offset-2">
                    <div class="form-group">
                        <input type="email" name="email" class="form-control" id="newemail"
                            placeholder="{t k='yournewemail' g='account'}" required>
                    </div>
                </div>
            </div>
                <div class="row" >
                <div class="col-md-6 col-md-offset-2">
                    <input type="submit" value="{t k='setaccountemail' g='account' }" class="btn btn-primary btn-block btn-lg" ></div>
            </div>
            </form>
            </div>
            <div id="emailchangebodymessage" style="display:none;">
            {t k='newemailmessagesent' g='account'}
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">{t key="close" }</button>
        </div>
        </div>

    </div>
</div>
<div id="namechange" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">{t key="changename" group="account"}</h4>
        </div>
        <div class="modal-body" id="emailchangebody">
            <div id="namechangebodyform">
            <form role="form" method="POST" action="{link do="changeaccname" controller="profile"}" >
            <div class="row">
                <div class="col-md-6 col-md-offset-2">
                    <div class="form-group">
                        <input type="text" name="name" class="form-control" id="name"
                            placeholder="{t k='yourname' g='account'}" required>
                    </div>
                </div>
            </div>
                <div class="row" >
                <div class="col-md-6 col-md-offset-2">
                    <input type="submit" value="{t k='updateaccountname' g='account' }" class="btn btn-primary btn-block btn-lg" ></div>
            </div>
            </form>
            </div>
            <div id="namechangebodymessage" style="display:none;">
            {t k='namewasupdated' g='account'}
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">{t key="close"}</button>
        </div>
        </div>

    </div>
</div>
<div id="passwordchange" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">{t key="changepassword" group="account"}</h4>
        </div>
        <div class="modal-body" >
            <div id="passwordchangebodyform">
            <form role="form" method="POST" action="{link do="updatepassword" controller="profile"}" >
            <div class="row">
                <div class="col-md-8 col-md-offset-2">
                    <div class="form-group">
                        <input type="password" name="curpassword" class="form-control" id="curpassword"
                            placeholder="{t k='currentpassword' g='account'}" required>
                    </div>
                    <div class="form-group">
                        <input type="password" name="password" class="form-control" id="password"
                            placeholder="{t k='newpassword' g='account'}" required>
                    </div>
                    <div class="form-group">
                        <input type="password" name="password2" class="form-control" id="password2"
                            placeholder="{t k='newpasswordconfirm' g='account'}" required>
                    </div>
                </div>
            </div>
                <div class="row" >
                <div class="col-md-8 col-md-offset-2">
                    <input type="submit" value="{t k='updateaccountpassword' g='account' }" class="btn btn-primary btn-block btn-lg" ></div>
            </div>
            </form>
            </div>
            <div id="passwordchangebodymessage" style="display:none;">
            {t k='passwordupdated' g='account'}
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">{t key="close" }</button>
        </div>
        </div>

    </div>
</div>


<script type="text/javascript">
{literal}

$(function() {

    $( "#emailchange form" ).submit(function( event ) {
        
        event.preventDefault();
        
        var newemail = $("#newemail").val();
        
        $.ajax({
            url: "{/literal}{link do='changeaccemail' controller='profile'}{literal}",
            type: "POST",
            dataType: "json",
            data: {
                email: newemail,
                responseformat: 'json'
            },
            cache: false,
            success: function(data) {
                
                if (data.status == 'ok') {
                    $('#emailchangebodyform').hide();
                    $('#emailchangebodymessage').show();
                } else {
                    alert(data.message);
                }
             
            },
            error: function() {
                alert('Unexpected error. Try again');
            },
        })
    });
    $( "#namechange form" ).submit(function( event ) {
        
        event.preventDefault();
        
        var name = $("#name").val();
        
        $.ajax({
            url: "{/literal}{link do='changeaccname' controller='profile'}{literal}",
            type: "POST",
            dataType: "json",
            data: {
                name: name,
                responseformat: 'json'
            },
            cache: false,
            success: function(data) {
                
                if (data.status == 'ok') {
                    $('#namechangebodyform').hide();
                    $('#namechangebodymessage').show();
                } else {
                    alert(data.message);
                }
             
            },
            error: function() {
                alert('Unexpected error. Try again');
            },
        })
    });
    $( "#passwordchange form" ).submit(function( event ) {
        
        event.preventDefault();
        
        var curpassword = $("#curpassword").val();
        var password = $("#password").val();
        var password2 = $("#password2").val();
        
        var form = $(this);
        
        if (password != password2) {
            alert('{/literal}{t key="passwordandconfirmdoesntmach" group="account"}{literal}');
            return false;
        }
        
        $.ajax({
            url: "{/literal}{link do='updatepassword' controller='profile'}{literal}",
            type: "POST",
            dataType: "json",
            data: {
                password: password,
                curpassword: curpassword,
                responseformat: 'json'
            },
            cache: false,
            success: function(data) {
                
                if (data.status == 'ok') {
                    $('#passwordchangebodyform').hide();
                    $('#passwordchangebodymessage').show();
                } else {
                    alert(data.message);
                    form.reset();
                }
             
            },
            error: function() {
                alert('Unexpected error. Try again');
            },
        })
    });
    
});
{/literal}
</script>
